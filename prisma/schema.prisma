generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [Uuid(map: "uuid-ossp"), Citext(map: "citext")]
}

model KnowledgeBase {
  id              String                  @id @default(cuid())
  uuid            String                  @db.Uuid
  orgUuid         String                  @db.Uuid
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  isDeleted       Boolean                 @default(false)
  slug            String
  title           String                  @db.Citext
  description     String
  defaultLanguage String
  layout          String
  color           Int
  enabled         Boolean
  languages       String
  links           String
  logo            String
  seoImage        String
  categories      KnowledgeBaseCategory[]
  articles        KnowledgeBaseArticle[]
  views           KnowledgeBaseViews[]

  @@unique([slug])
}

model KnowledgeBaseCategory {
  id              String                         @id @default(cuid())
  uuid            String                         @db.Uuid
  knowledgeBaseId String
  knowledgeBase   KnowledgeBase                  @relation(fields: [knowledgeBaseId], references: [id])
  createdAt       DateTime                       @default(now())
  updatedAt       DateTime                       @updatedAt
  isDeleted       Boolean                        @default(false)
  slug            String
  order           Int
  title           String                         @db.Citext
  description     String
  icon            String
  language        String
  seoImage        String
  sections        KnowledgeBaseCategorySection[]
  articles        KnowledgeBaseArticle[]

  @@unique([knowledgeBaseId, slug])
}

model KnowledgeBaseCategorySection {
  id          String                 @id @default(cuid())
  uuid        String                 @db.Uuid
  categoryId  String
  category    KnowledgeBaseCategory  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  isDeleted   Boolean                @default(false)
  order       Int
  title       String                 @db.Citext
  description String
  articles    KnowledgeBaseArticle[]
}

model KnowledgeBaseArticle {
  id                 String                          @id @default(cuid())
  uuid               String                          @db.Uuid
  createdAt          DateTime                        @default(now())
  updatedAt          DateTime?                       @updatedAt
  createdBy          String                          @db.Uuid
  updatedBy          String                          @db.Uuid
  isDeleted          Boolean                         @default(false)
  knowledgeBaseId    String
  knowledgeBase      KnowledgeBase                   @relation(fields: [knowledgeBaseId], references: [id])
  categoryId         String?
  category           KnowledgeBaseCategory?          @relation(fields: [categoryId], references: [id])
  sectionId          String?
  section            KnowledgeBaseCategorySection?   @relation(fields: [sectionId], references: [id])
  slug               String
  title              String                          @db.Citext
  description        String
  order              Int
  contentDraft       String
  contentPublished   String
  contentType        String
  language           String
  featuredOrder      Int?
  author             String
  seoImage           String
  publishStatus      String
  editLock           Boolean                         @default(false)
  publishedAt        DateTime?
  relatedInArticleId String?
  relatedInArticle   KnowledgeBaseArticle?           @relation("relatedArticles", fields: [relatedInArticleId], references: [id])
  relatedArticles    KnowledgeBaseArticle[]          @relation("relatedArticles")
  views              KnowledgeBaseArticleViews[]
  upvotes            KnowledgeBaseArticleUpvotes[]
  downvotes          KnowledgeBaseArticleDownvotes[]

  @@unique([knowledgeBaseId, slug])
}

// model KnowledgeBaseArticleReaction {
//   id        String               @id @default(cuid())
//   createdAt DateTime             @default(now())
//   articleId String
//   article   KnowledgeBaseArticle @relation(fields: [articleId], references: [id])
//   cookie    String
//   type      String
// }

model KnowledgeBaseViews {
  id              String        @id @default(cuid())
  createdAt       DateTime      @default(now())
  knowledgeBaseId String
  knowledgeBase   KnowledgeBase @relation(fields: [knowledgeBaseId], references: [id], onDelete: Cascade)
  userAnalyticsId String

  @@unique([knowledgeBaseId, userAnalyticsId])
}

model KnowledgeBaseArticleViews {
  knowledgeBaseArticleId String
  knowledgeBaseArticle   KnowledgeBaseArticle @relation(fields: [knowledgeBaseArticleId], references: [id], onDelete: Cascade)
  userAnalyticsId        String

  @@unique([knowledgeBaseArticleId, userAnalyticsId])
}

model KnowledgeBaseArticleUpvotes {
  createdAt              DateTime             @default(now())
  knowledgeBaseArticleId String
  knowledgeBaseArticle   KnowledgeBaseArticle @relation(fields: [knowledgeBaseArticleId], references: [id], onDelete: Cascade)
  userAnalyticsId        String

  @@unique([knowledgeBaseArticleId, userAnalyticsId])
}

model KnowledgeBaseArticleDownvotes {
  createdAt              DateTime             @default(now())
  knowledgeBaseArticleId String
  knowledgeBaseArticle   KnowledgeBaseArticle @relation(fields: [knowledgeBaseArticleId], references: [id], onDelete: Cascade)
  userAnalyticsId        String

  @@unique([knowledgeBaseArticleId, userAnalyticsId])
}
